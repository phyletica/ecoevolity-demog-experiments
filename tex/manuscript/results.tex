\subsection{Analyses of simulated data}

\subsubsection{Estimating timing and sharing of demographic changes}

The ability of \ecoevolity to estimate the timing of
demographic events
(\fig{}~\ref{fig:valsimsetimesinitial})
and the assignment of populations to the
events
(\fig{}~\ref{fig:valsimsmodelinitial})
was quite poor across all the simulation conditions we initially explored.
For these initial conditions, we simulated \datasets with three populations
that underwent a demographic change, under a variety of distributions on the
relative size of the ancestral population.
These included four gamma probability distributions with a shape of 10 and a
mean of
0.25 (4-fold population increase),
0.5 (2-fold population increase),
2.0 (2-fold population decrease), and
1.0 (no change on average, but a fair amount of variance).
We also used a gamma distribution with a shape of 100 and mean of 1.0
to mimic ``worst-case'' conditions when there was almost no demographic
changes in the history of the populations.
The timing of unique size changes was exponentially distributed with a mean of
0.01 expected substitutions per site.
The expected descendant population size
(scaled by the mutation rate; \epopsize\murate)
was 0.002,
which puts our expectation for the size-change times in units of $4N_e$
generations at 1.25.
Our motivation for this distribution of times was to span values
that were ``easy'' and ``hard'' to estimate;
i.e., a mix of size changes that occurred more recently
than the gene copies coalesced and thus would be generate data with information
about when the change happened,
and those that occurred when few or no gene lineages were left to coalesce, and
thus would generate data with limited information about the timing of the
event.

\ifembed{
\input{fig-sims-event-times-initial.tex}
}{}

\ifembed{
\input{fig-sims-model-initial.tex}
}{}

Under the ``worst-case'' scenario of essentially no population-size change
(bottom row of \figs \ref{fig:valsimsetimesinitial} and
\ref{fig:valsimsmodelinitial}), our method is unable to identify the timing or
model of demographic change.
The method returns the prior on the timing of events 
(bottom row of \figs \ref{fig:valsimsetimesinitial})
and almost always prefers either a model with a single, shared demographic
event (model "000") or independent demographic changes (model "012").
(bottom row of \figs \ref{fig:valsimsmodelinitial}).
This is expected behavior, because there is essentially no information in the
data about the timing of demographic changes, and a Dirichlet process with a
concentration parameter of 1.41422, puts approximately 0.24 prior probability
on the models with one and three events, and 0.515 prior probability on the
three models with two events (approximately 0.17 each).
Thus, with little information, the method prefers one of the two models with
larger prior probability.

Under considerable changes in population size, the method only faired
marginally better at estimating the timing of demographic events
(top three rows of \figs \ref{fig:valsimsetimesinitial}).
The ability to identify the model improved under these
conditions, but the frequency at which the correct model
was preferred only exceeded 50\% for the large population
expansions, and the median posterior support for the correct
model was very small (less than 0.58) under all conditions.
(top three rows of \figs \ref{fig:valsimsmodelinitial}).

Results were quite poor across all conditions, but slightly better for the most dramatic pop expansions.
In an effort to find conditions where we could estimate demographic change times reasonble, we next simulated conditions where strong population expansions (relative root size gamma(10, mean = 0.25) and gamma(10, mean = 0.5)) occurred very recently (exponential with mean 0.001).

The improved performance was quite modest, and we ran into numerical issues when the
population expansion so recent that it was difficult to identify.
In these cases, the data were well explained by no expansion, which could be achieved in two ways: an expansion time of zero and an ancestral population size that matched the true ancestral population size, or an old expansion and a ldescendant population size that matched the true ancestral population size. The latter explained the data equally well when the divergence time was older than gene tree coalescences. This lead to MCMC chains converging to these different regions of parameter space.

This lead us to try tighter distribution on times with an offest to avoid
near-zero values, as well as offsest on the size of descendant populations and
ancestral relative sizes to avoid near-zero values (which cause rapid
coalescence, and thus no signal). The prior conditions we simulted under are:


\subsubsection{But what about under realistic prior information (diffuseprior)}

It was a lot of work to find conditions where we could reasonably estimate
the timing and number of demographic change events.
These condtions include quite informative distributions on parameters,
especially the relative size of the ancestral population.
We used the same distribution as the prior, and thus the informative priors
could be why the behavior is better (as opposed to the data containing a strong
signal of what happened).
To determine this, we simulated data under the best conditions,
but then analyzed these data under diffuse priors to see how
well we can expect to estimate.
This is important because in real world applications we usually know very
little about the timing and magnitude (and direction) of size changes.

Sim disributions:

Event time ~ gamma(shape=4.0, scale=0.000475, offset=0.0001); mean 0.002

relative root size ~ gamma(shape=5.0, scale = 0.04, offset = 0.05); mean 0.25

relative root size ~ gamma(shape=5.0, scale = 0.04, offset = 3.8); mean 4.0

descendant size ~ gamma(4.0, scale=0.0005, offset = 0.0001); mean 0.0021

Priors:

Event time ~ exponential(mean = 0.005)

relative root size ~ Exponential(mean = 2.0)

descendant size ~ gamma(2.0, scale 0.001); mean 0.002


\subsection{Simulating a mix of divergence and pop-size-change comparisons}
What if we have a mix of pairs?


\subsection{Simulating linked sites}
Should we analyze all the sites or just unlinked SNPs?


\subsection{Data-acquisition bias?}


\subsection{Empirical application}
Stickleback data.



